<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="Perforce Professional Services">
<title>P4Transfer - Helix Core Full History Migration Tool</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book">
<div id="header">
<h1>P4Transfer - Helix Core Full History Migration Tool</h1>
<div class="details">
<span id="author" class="author">Perforce Professional Services</span><br>
<span id="email" class="email"><a href="mailto:consulting@perforce.com">consulting@perforce.com</a></span><br>
<span id="revnumber">version v2022.1,</span>
<span id="revdate">2022-10-15</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_p4transfer_vs_helix_native_dvcs_functions">2. P4Transfer vs Helix native DVCS functions</a>
<ul class="sectlevel2">
<li><a href="#_guidance_on_tool_differences">2.1. Guidance on tool differences</a></li>
</ul>
</li>
<li><a href="#_implementation">3. Implementation</a>
<ul class="sectlevel2">
<li><a href="#_classiclocal_target_depots_vs_streams_targets">3.1. Classic/local target depots vs Streams targets</a></li>
</ul>
</li>
<li><a href="#_setup">4. Setup</a>
<ul class="sectlevel2">
<li><a href="#_installing_p4transfer_py">4.1. Installing P4Transfer.py</a></li>
<li><a href="#_getting_started">4.2. Getting started</a></li>
<li><a href="#_script_parameters">4.3. Script parameters</a></li>
<li><a href="#_optional_parameters">4.4. Optional Parameters</a></li>
<li><a href="#_long_running_jobs">4.5. Long running jobs</a></li>
<li><a href="#_setting_up_environment">4.6. Setting up environment</a></li>
<li><a href="#_convenience_aliases">4.7. Convenience aliases</a></li>
<li><a href="#_configuration_options">4.8. Configuration Options</a>
<ul class="sectlevel3">
<li><a href="#_changelist_comment_formatting">4.8.1. Changelist comment formatting</a></li>
<li><a href="#_recording_a_change_list_mapping_file">4.8.2. Recording a change list mapping file</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_misc_usage_notes">5. Misc Usage Notes</a>
<ul class="sectlevel2">
<li><a href="#_integration_recrods">5.1. Integration Recrods</a></li>
<li><a href="#_setting_up_as_a_service_on_windows">5.2. Setting up as a service on Windows</a></li>
<li><a href="#_comparing_repositories_and_fixing_any_differences">5.3. Comparing Repositories (and fixing any differences)</a>
<ul class="sectlevel3">
<li><a href="#_comparerepos_py">5.3.1. CompareRepos.py</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_support">6. Support</a>
<ul class="sectlevel2">
<li><a href="#_re_running_p4transfer_after_an_error">6.1. Re-running P4Transfer after an error</a></li>
</ul>
</li>
<li><a href="#_contributors_guide">7. Contributor&#8217;s Guide</a>
<ul class="sectlevel2">
<li><a href="#_test_dependencies">7.1. Test dependencies</a></li>
<li><a href="#_running_a_single_test">7.2. Running a single test</a></li>
<li><a href="#_running_all_tests">7.3. Running all tests</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The script <a href="../P4Transfer.py">P4Transfer.py</a> solves the problem: how to transfer changes between unrelated and unconnected Perforce Helix Core repositories.</p>
</div>
<div class="paragraph">
<p>If you have a 2015.1 or greater Helix Core server then you can use the <a href="https://www.perforce.com/manuals/dvcs/Content/DVCS/Home-dvcs.html">Helix native DVCS</a> commands (<code>p4 clone</code>/<code>p4 fetch</code>/<code>p4 push</code>). If you have a pre-2015.1 version of Helix Core (or very large repository sizes to be transferred), then <code>P4Transfer.py</code> may be your best option! See next section for guidance.</p>
</div>
<div class="paragraph">
<p>While best practice is usually to have only one Perforce Server, the reality is often that many different Perforce Servers are required. A typical example is the Perforce public depot, which sits outside the Perforce Network.</p>
</div>
<div class="paragraph">
<p>Sometimes you start a project on one server and then realize that it would be nice to replicate these changes to another server. For example, you could start out on a local server on a laptop while being on the road but would like to make the results available on the public server. You may also wish to consolidate various Perforce servers into one with all their history (e.g. after an acquisition of another company).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_p4transfer_vs_helix_native_dvcs_functions">2. P4Transfer vs Helix native DVCS functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Both Helix native DVCS and P4Transfer enable migration of detailed file history from a set of paths on one Helix Core server into another server.</p>
</div>
<div class="paragraph">
<p><a href="https://www.perforce.com/manuals/dvcs/Content/DVCS/Home-dvcs.html">Helix native DVCS</a> has additional functionality, such as creating a personal micro-repo for personal use without a continuously running <code>p4d</code> process.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When it is an option, using Helix native DVCS is preferred.  But if that can’t be used for some reason, P4Transfer can pretty much always be made to work.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The new <a href="FetchTransfer.html">FetchTransfer.py</a> script is a wrapper around the DVCS <code>p4 fetch</code> command with some advantages over P4Transfer.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_guidance_on_tool_differences">2.1. Guidance on tool differences</h3>
<div class="paragraph">
<p>Pros for native DVCS:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Helix native DVCS is a fully supported product feature.</p>
</li>
<li>
<p>Helix native DVCS requires consistency among the Helix Core servers: Same case sensitivity setting, same Unicode mode, and same P4D version (with some exceptions).</p>
</li>
<li>
<p>Helix native DVCS is easy to setup and use.</p>
</li>
<li>
<p>Helix native DVCS requires particular configurables to be setup, and may be viewed as a security concern for the extraction of history (this can be controlled with pre-command triggers)</p>
</li>
<li>
<p>Helix native DVCS has some limitations at larger scales (depends on server RAM as it creates zip files) - won&#8217;t scale to TB requiring to be transferred.</p>
</li>
<li>
<p>Helix native DVCS is generally deemed to produce the highest possible quality data on the target server, as it transfers raw journal data and archive content.</p>
</li>
<li>
<p>Helix native DVCS is very fast.</p>
</li>
<li>
<p>Helix native DVCS has no external dependencies.</p>
</li>
<li>
<p>Helix native DVCS bypasses submit triggers which can interfere with P4Transfer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When P4Transfer might be a better option:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If Helix native DVCS hits data snags, there may not be an easy way to work around them, unless a new P4D server release address them.</p>
</li>
<li>
<p>Helix native DVCS must be explicitly enabled.  If not already enabled, it requires 'super' access on both Helix Core servers involved in the process.</p>
</li>
<li>
<p>P4Transfer is community supported (and with paid Consulting engagements).</p>
</li>
<li>
<p>P4Transfer can make timestamps more accurate if it has 'admin' level access, but does not require it.</p>
</li>
<li>
<p>P4Transfer automates front-door workflows, i.e. it does would a human with a <code>p4</code> command line client, fleet fingers and a lot of time could do.</p>
</li>
<li>
<p>P4Transfer can work with mismatched server data sets (different case sensitivity, Unicode mode, or P4D settings) <strong>so long as</strong> the actual data to be migrated doesn&#8217;t cause issues.  (For example, if you try to copy paths that actually do have Korean glyphs in the path name to a non-Unicode server, that ain&#8217;t gonna work).</p>
</li>
<li>
<p>If P4Transfer does have issues with importing some data (like the above example with Unicode paths), you can manually work around those snags, and then pick up with the next changelist.  If there aren’t too many snags, this trial and error process is viable.</p>
</li>
<li>
<p>P4Transfer is reasonably fast as a front-door mechanism.</p>
</li>
<li>
<p>P4Transfer can be run as a service for continuous operation, and has successfully run for months or more.</p>
</li>
<li>
<p>P4Transfer data quality is excellent in terms of detail (e.g. integration history, resolve options, etc.).  However, it is an emulation of history rather than a raw replay of  actually history in the native format as done by Helix native DVCS.  The nuance in history differences rarely has practical implications.</p>
</li>
<li>
<p>P4Transfer requires more initial setup than Helix native DVCS.</p>
</li>
<li>
<p>P4Transer requires Python (2.7 or 3.6+).</p>
</li>
<li>
<p>P4Transfer can be interfered with by custom policy enforcement triggers on the target server.</p>
</li>
<li>
<p>P4Transfer is subject to submit triggers that may block its operation, possibly intentionally.</p>
</li>
<li>
<p>Helix native DVCS requires a direct connection betwen the related p4d servers, whereas P4Transfer requires only a connection from a client machine to each of the p4d servers. Thus, P4Transfer can operate as long as it operates in an environment where it can reach each of the target p4d servers, even of those p4d servers cannot communicate directly with each other, e.g. due to network firewalls.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation">3. Implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The basic idea is to create a client workspace on each Perforce Server that maps the projects to be transferred. Both client workspaces must share the same root directory and client side mapping. For example:</p>
</div>
<div class="paragraph">
<p>Source client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Client: workspace_server1

Root: /work/transfer

View:
    //depot/myproject/dev/... //workspace_server1/depot/myproject/dev/...
    //depot/other/dev/... //workspace_server1/depot/other/dev/...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Target client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Client: workspace_server2

Root: /work/transfer

View:
    //import/mycode/... //workspace_server2/depot/myproject/dev/...
    //import/stuff/... //workspace_server2/depot/other/dev/...</code></pre>
</div>
</div>
<div class="paragraph">
<p>These client workspaces are created automatically from the <code>view</code> entries in the config file described below.</p>
</div>
<div class="paragraph">
<p>P4Transfer works uni-directionally. The tool will inquire the changes for the workspace files and compare these to a counter.</p>
</div>
<div class="paragraph">
<p>P4Transfer uses a single configuration file that contains the information of both servers as well as the current counter values. The tool maintains its state counter using a Perforce counter on the target server (thus requiring <code>review</code> privilege as well as <code>write</code> privilege – by default it assumes <code>super</code> user privilege is required since it updates changelist owners and date/time to the same as the source – this functionality is controlled by the config file).</p>
</div>
<div class="sect2">
<h3 id="_classiclocal_target_depots_vs_streams_targets">3.1. Classic/local target depots vs Streams targets</h3>
<div class="paragraph">
<p>It is now possible to migrate streams to streams. This is done by creating a source workspace which can read any specified stream (it is just a normal workspace since syncing from any stream is possible). The target workspace is a special stream workspace which is a mainline with no <code>share &#8230;&#8203;</code> line in it, but which uses <code>import+</code> to write to all the desired target streams.</p>
</div>
<div class="paragraph">
<p>Notes/restrictions on streams:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Currently supports streams&#8594;streams only (not classic to streams)</p>
</li>
<li>
<p>Takes whole streams rather than allowing filtering of source streams</p>
</li>
<li>
<p>Will auto-create target streams if necessary when you use wildcard matching ('*') in source/target stream names,
e.g. allowing you to take all <code>//streams_depot/release*</code> streams across easily.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Remember that humans should not be writing to the targets of a P4Transfer instance (streams or otherwise) - or the script may fail in strange ways!
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup">4. Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You will need Python 2.7 or 3.6+ and P4Python 2017.2+ to make this script work.</p>
</div>
<div class="paragraph">
<p>The easiest way to install P4Python is probably using "pip" (or "pip3") – <a href="https://pip.pypa.io/en/stable/installing.html">make sure this is installed</a>. Then:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>pip install p4python</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the above needs to build and fails, then this usually works for Python 3.6: <code>pip3 install p4python==2017.2.1615960</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, refer to <a href="https://www.perforce.com/manuals/p4python/Content/P4Python/python.installation.html">P4Python Docs</a></p>
</div>
<div class="paragraph">
<p>If you are on Windows, then look for an appropriate version on the Perforce ftp site (for your Python version), e.g. <a href="http://ftp.perforce.com/perforce/r20.1/bin.ntx64/" class="bare">http://ftp.perforce.com/perforce/r20.1/bin.ntx64/</a></p>
</div>
<div class="sect2">
<h3 id="_installing_p4transfer_py">4.1. Installing P4Transfer.py</h3>
<div class="paragraph">
<p>The easiest thing to do is to download this repo either by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>running <code>git clone <a href="https://github.com/perforce/p4transfer" class="bare">https://github.com/perforce/p4transfer</a></code></p>
</li>
<li>
<p>or by downloading <a href="https://github.com/perforce/p4transfer/archive/main.zip">the project zip file</a> and unzipping.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The minimum requirements are the modules <code>P4Transfer.py</code> and <code>logutils.py</code></p>
</div>
<div class="paragraph">
<p>If you have installed P4Python as above, then check the <code>requirements.txt</code> for other modules to install via <code>pip</code> or <code>pip3</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_getting_started">4.2. Getting started</h3>
<div class="paragraph">
<p>Note that if running it on Windows, and especially if the source server has filenames containing say umlauts or other non-ASCII characters, then Python 2.7 is required currently due to the way Unicode is processed. Python 3.6+ on Mac/Unix should be fine with Unicode as long as you are using P4Python 2017.2+</p>
</div>
<div class="paragraph">
<p>Create the workspaces for both servers, ensuring that the root directories and client views match.</p>
</div>
<div class="paragraph">
<p>Now initialize the configuration file, by default called <code>transfer.cfg</code>. This can be generated by the script:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>python3 P4Transfer.py --sample-config &gt; transfer.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>Then edit the resulting file, paying attention to the comments.</p>
</div>
<div class="paragraph">
<p>The password stored in P4Passwd is optional if you do not want to rely on tickets. The tool performs a login if provided with a password, so it should work with <code>security=3</code> or <code>auth_check</code> trigger set.</p>
</div>
<div class="paragraph">
<p>Note that although the workspaces are named the same for both servers in this example, they are completely different entities.</p>
</div>
<div class="paragraph">
<p>A typical run of the tool would produce the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>C:\work\&gt; python3 P4Transfer.py -c transfer.yaml -r
2014-07-01 15:32:34,356:P4Transfer:INFO: Transferring 0 changes
2014-07-01 15:32:34,361:P4Transfer:INFO: Sleeping for 1 minutes</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there are any changes missing, they will be applied consecutively.</p>
</div>
</div>
<div class="sect2">
<h3 id="_script_parameters">4.3. Script parameters</h3>
<div class="paragraph">
<p>P4Transfer has various options – these are documented via the <code>-h</code> or <code>--help</code> parameters.</p>
</div>
<div class="paragraph">
<p>The following text may not display properly if your are viewing this P4Transfer.adoc file in GitHub. Please refer
the the .pdf version instead, or open up <a href="help.txt">help.txt</a> file directly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>usage: P4Transfer.py [-h] [-c CONFIG] [-n] [-m MAXIMUM] [-k] [-r] [-s]
                     [--sample-config] [-i] [--end-datetime END_DATETIME]

NAME:
    P4Transfer.py

DESCRIPTION:
    This python script (2.7/3.6+ compatible) will transfer Perforce changelists with all contents
    between independent servers when no remote depots are possible, and P4 DVCS commands
    (such as p4 clone/fetch/zip/unzip) are not an option.

    This script transfers changes in one direction - from a source server to a target server.

    Usage:

        python3 P4Transfer.py -h

    The script requires a config file, by default transfer.yaml,
    that provides the Perforce connection information for both servers.

    An initial example can be generated, e.g.

        P4Transfer.py --sample-config &gt; transfer.yaml

    For full documentation/usage, see project doc:

        https://github.com/perforce/p4transfer/blob/main/doc/P4Transfer.adoc

optional arguments:
  -h, --help            show this help message and exit
  -c CONFIG, --config CONFIG
                        Default is transfer.yaml
  -n, --notransfer      Validate config file and setup source/target
                        workspaces but don't transfer anything
  -m MAXIMUM, --maximum MAXIMUM
                        Maximum number of changes to transfer
  -k, --nokeywords      Do not expand keywords and remove +k from filetype
  -r, --repeat          Repeat transfer in a loop - for continuous transfer as
                        background task
  -s, --stoponerror     Stop on any error even if --repeat has been specified
  --sample-config       Print an example config file and exit
  -i, --ignore-integrations
                        Treat integrations as adds and edits
  --end-datetime END_DATETIME
                        Time to stop transfers, format: 'YYYY/MM/DD HH:mm' -
                        useful for automation runs during quiet periods e.g.
                        run overnight but stop first thing in the morning

Copyright (C) 2012-21 Sven Erik Knop/Robert Cowham, Perforce Software Ltd</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_optional_parameters">4.4. Optional Parameters</h3>
<div class="ulist">
<ul>
<li>
<p><code>--notransfer</code> - useful to validate your config file and that you can connect to source/target p4d servers, and report on how many changes might be transferred.</p>
</li>
<li>
<p><code>--maximum</code> - useful to perform a test transfer of a single changelist when you get started (although remember this might be a changelist with a lot of files!)</p>
</li>
<li>
<p><code>--keywords</code> - useful to avoid issues with expanding of keywords on a different server. Keywords make it hard to compare source/target results, and make transfers slower due to extra work required.</p>
</li>
<li>
<p><code>--end-datetime</code> - useful to schedule a run of P4Transfer and have it stop at the desired time (e.g. run overnight and stop when users start work in the morning). Useful for scheduling long running transfers (can be many days) in quiet periods (e.g. together with Linux <code>at</code> command)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_long_running_jobs">4.5. Long running jobs</h3>
<div class="paragraph">
<p>On Linux, recommend you execute it as a background process, and then monitor the output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>nohup python3 P4Transfer.py -c transfer.yaml -r &gt; out1 &amp;</pre>
</div>
</div>
<div class="paragraph">
<p>This will run in the background, and poll for new changes (according to <code>poll_interval</code> in the config file.)</p>
</div>
<div class="paragraph">
<p>You can look at the output file for progress, e.g. (avoiding long lines of text which can be output), or grep the log file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tail -f out1 | cut -c -140</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>grep :INFO: log-P4Transfer-*.log</pre>
</div>
</div>
<div class="paragraph">
<p>Note that if you edit the configuration file, it will be re-read the next time the script wakes up and polls for input. So you do not need to stop and restart the job.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_environment">4.6. Setting up environment</h3>
<div class="paragraph">
<p>The following simple setup will allow you to cross check easily source and target servers.
Assume we are in a directory: <code>/some/path/p4transfer</code></p>
</div>
<div class="literalblock">
<div class="content">
<pre>export P4CONFIG=.p4config
mkdir source target
cd source
vi .p4config</pre>
</div>
</div>
<div class="paragraph">
<p>and create appropriate values as per your config file for the source server e.g.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat .p4config
P4PORT=source-server:1666
P4USER=p4transfer
P4CLIENT=p4transfer_client</pre>
</div>
</div>
<div class="paragraph">
<p>And similarly create a file in the <code>target</code> sub-directory.</p>
</div>
<div class="paragraph">
<p>This will allow you to quickly and easily <code>cd</code> between directories and be able to run commands against respective
source and target p4d instances.</p>
</div>
</div>
<div class="sect2">
<h3 id="_convenience_aliases">4.7. Convenience aliases</h3>
<div class="paragraph">
<p>The following <code>bash</code> aliases may be useful:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>alias glog='export lastlogfile=$(ls -tr log-P4Transfer*.log | tail -1)'
alias tlog='tail $lastlogfile | cut -c -400'
alias clog='cut -c -400 $lastlogfile | less'</pre>
</div>
</div>
<div class="paragraph">
<p>They allow you to quickly update the latest log file and have a look at progress or errors. Note the <code>cut</code> command is used to avoid some
hugely long lines which may be present in the log file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_options">4.8. Configuration Options</h3>
<div class="paragraph">
<p>The comments in the file are mostly self-explanatory. It is important to specify the main values for the <code>[source]</code> and <code>[target]</code> sections.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>P4Transfer.py --sample-config &gt; transfer.yaml</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>cat transfer.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>The following included text may not display correctly when this .adoc file is  viewed in GitHub - instead
download the PDF version of this doc, or open <a href="transfer.yaml">transfer.yaml</a> directly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># Save this output to a file to e.g. transfer.yaml and edit it for your configuration

# counter_name: Unique counter on target server to use for recording source changes processed. No spaces.
#    Name sensibly if you have multiple instances transferring into the same target p4 repository.
#    The counter value represents the last transferred change number - script will start from next change.
#    If not set, or 0 then transfer will start from first change.
counter_name: p4transfer_counter

# case_sensitive: Set this to True if source/target servers are both case sensitive.
#    Otherwise case inconsistencies can cause problems when conversion runs on Linux
case_sensitive: true

# historical_start_change: Set this if you require P4Transfer to start with this changelist.
#    A historical start is useful if you have 100,000 changelists in source server and want to only
#    transfer the last 10,000. Set this value to the first change to be transferred.
#    Once you have set this value and started a transfer DO NOT MODIFY IT or you will potentially
#    mess up integration history etc!!!!!
#    IMPORTANT NOTE: setting this value causes extra work to be done for every integration to adjust
#    revision ranges - thus slowing down transfers.
#    If not set, or 0 then transfer starts from the value of counter_name above, and assumes that ALL HISTORY
#    of included files is transferred.
historical_start_change:

# instance_name: Name of the instance of P4Transfer - for emails etc. Spaces allowed.
instance_name: Perforce Transfer from XYZ

# For notification - if smtp not available - expects a pre-configured nms FormMail script as a URL
#   E.g. expects to post using 2 fields: subject, message
# Alternatively, use the following entries (suitable adjusted) to use Mailgun for notifications
#   api: "&lt;Mailgun API key"
#   url: "https://api.mailgun.net/v3/&lt;domain or sandbox&gt;"
#   mail_from: "Fred &lt;fred@example.com&gt;"
#   mail_to:
#   - "fred@example.com"
mail_form_url:

# The mail_* parameters must all be valid (non-blank) to receive email updates during processing.
# mail_to: One or more valid email addresses - comma separated for multiple values
#     E.g. somebody@example.com,somebody-else@example.com
mail_to:

# mail_from: Email address of sender of emails, E.g. p4transfer@example.com
mail_from:

# mail_server: The SMTP server to connect to for email sending, E.g. smtpserver.example.com
mail_server:

# ===============================================================================
# Note that for any of the following parameters identified as (Integer) you can specify a
# valid python expression which evaluates to integer value, e.g.
#     "24 * 60"
#     "7 * 24 * 60"
# Such values should be quoted (in order to be treated as strings)
# -------------------------------------------------------------------------------
# sleep_on_error_interval (Integer): How long (in minutes) to sleep when error is encountered in the script
sleep_on_error_interval: 60

# poll_interval (Integer): How long (in minutes) to wait between polling source server for new changes
poll_interval: 60

# change_batch_size (Integer): changelists are processed in batches of this size
change_batch_size: 1000

# The following *_interval values result in reports, but only if mail_* values are specified
# report_interval (Integer): Interval (in minutes) between regular update emails being sent
report_interval: 30

# error_report_interval (Integer): Interval (in minutes) between error emails being sent e.g. connection error
#     Usually some value less than report_interval. Useful if transfer being run with --repeat option.
error_report_interval: 15

# summary_report_interval (Integer): Interval (in minutes) between summary emails being sent e.g. changes processed
#     Typically some value such as 1 week (10080 = 7 * 24 * 60). Useful if transfer being run with --repeat option.
summary_report_interval: 7 * 24 * 60

# sync_progress_size_interval (Integer): Size in bytes controlling when syncs are reported to log file.
#    Useful for keeping an eye on progress for large syncs over slow network links.
sync_progress_size_interval: 500 * 1000 * 1000

# max_logfile_size (Integer): Max size of file to (in bytes) after which it should be rotated
#     Typically some value such as 20MB = 20 * 1024 * 1024. Useful if transfer being run with --repeat option.
max_logfile_size: 20 * 1024 * 1024

# change_description_format: The standard format for transferred changes.
#    Keywords prefixed with $. Use \\n for newlines. Keywords allowed:
#     $sourceDescription, $sourceChange, $sourcePort, $sourceUser
change_description_format: \"$sourceDescription\\n\\nTransferred from p4://$sourcePort@$sourceChange\"

# change_map_file: Name of an (optional) CSV file listing mappings of source/target changelists.
#    If this is blank (DEFAULT) then no mapping file is created.
#    If non-blank, then a file with this name in the target workspace is appended to
#    and will be submitted after every sequence (batch_size) of changes is made.
#    Default type of this file is text+CS32 to avoid storing too many revisions.
#    File must be mapped into target client workspace.
#    File can contain a sub-directory, e.g. change_map/change_map.csv
#    Note that due to the way client workspace views are created the local filename
#    should include a valid source path including depot name, e.g.
#       //depot/export/... -&gt; depot/export/change_map.csv
change_map_file:

# superuser: Set to n if not a superuser (so can't update change times - can just transfer them).
superuser: y

# ignore_files: An array of regex patterns which are used to ingore any matching files.
#    Allows you to ignore some issues which cause transfer problems.
#    E.g.
#    ignore_files:
#    - "some/files/to/*ignore$"
ignore_files:

source:
    # P4PORT to connect to, e.g. some-server:1666 - if this is on localhost and you just
    # want to specify port number, then use quotes: "1666"
  p4port:
    # P4USER to use
  p4user:
    # P4CLIENT to use, e.g. p4-transfer-client
  p4client:
    # P4PASSWD for the user - valid password. If blank then no login performed.
    # Recommended to make sure user is in a group with a long password timeout!.
    # Make sure your P4TICKETS file is correctly found in the environment
  p4passwd:
    # P4CHARSET to use, e.g. none, utf8, etc - leave blank for non-unicode p4d instance
  p4charset:

target:
    # P4PORT to connect to, e.g. some-server:1666 - if this is on localhost and you just
    # want to specify port number, then use quotes: "1666"
  p4port:
    # P4USER to use
  p4user:
    # P4CLIENT to use, e.g. p4-transfer-client
  p4client:
    # P4PASSWD for the user - valid password. If blank then no login performed.
    # Recommended to make sure user is in a group with a long password timeout!
    # Make sure your P4TICKETS file is correctly found in the environment
  p4passwd:
    # P4CHARSET to use, e.g. none, utf8, etc - leave blank for non-unicode p4d instance
  p4charset:

# workspace_root: Root directory to use for both client workspaces.
#    This will be used to update the client workspace Root: field for both source/target workspaces
#    They must be the same.
#    Make sure there is enough space to hold the largest single changelist that will be transferred!
workspace_root: /work/transfer

# views: An array of source/target view mappings
#    You are not allowed to specify both 'views' and 'stream_views' - leave one or other blank!!
#    Each value is a string - normally quote. Standard p4 wildcards are valid.
#    These values are used to construct the appropriate View: fields for source/target client workspaces
#    It is allowed to have exclusion mappings - by specifying the '-' as first character in 'src'
#    entry - see last example below.
views:
- src: //depot/source_path1/...
  targ: //import/target_path1/...
- src: //depot/source_path2/...
  targ: //import/target_path2/...
- src: -//depot/source_path2/exclude/*.tgz
  targ: //import/target_path2/exclude/*.tgz

# transfer_target_stream: The name of a special target stream to use - IT SHOULD NOT CONTAIN FILES!!
#    This will be setup as a mainline stream, with no sharing and with import+ mappings
#    It is in standard stream name format, e.g. //&lt;depot&gt;/&lt;name&gt; or //&lt;depot&gt;/&lt;mid&gt;/&lt;name&gt;
#    e.g. transfer_target_stream: //targ_streams/transfer_target
transfer_target_stream:

# stream_views: An array of source/target stream view mappings and other record fields.
#    You are not allowed to specify both 'views' and 'stream_views' - leave one or other blank
#    Each src/targ value is a string with '*' p4 wildcards to match stream names (like 'p4 streams //depot/rel*')
#    Multiple wildcards are allowed, but make sure the number of wildcards matches between source and target.
#    Please note that target depots must exist.
#    Target streams will be created as required using the specified type/parent fields.
#    Field 'type:' has allowed values: mainline, development, release
#    Field 'parent:' should specify a suitable parent if you are creating development or release streams.
stream_views:
- src: //streams_src/main
  targ: //streams_targ/main
  type: mainline
  parent: ''
- src: //streams_src2/release*
  targ: //streams_targ2/rel*
  type: mainline
  parent: //streams_targ2/main
- src: //src3_streams/*rel*
  targ: //targ3_streams/*release*
  type: mainline
  parent: //targ3_streams/main</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_changelist_comment_formatting">4.8.1. Changelist comment formatting</h4>
<div class="paragraph">
<p>In the <code>[general]</code> section, you can customize the <code>change_description_format</code> value to decide how transferred change descriptions are formatted.</p>
</div>
<div class="paragraph">
<p>Keywords in the format string are prefixed with <code>$</code>. Use <code>\n</code> for newlines. Keywords allowed are: <code>$sourceDescription</code>, <code>$sourceChange</code>, <code>$sourcePort</code>, <code>$sourceUser</code>.</p>
</div>
<div class="paragraph">
<p>Assume the source description is “Original change description”.</p>
</div>
<div class="paragraph">
<p>Default format:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$sourceDescription\n\nTransferred from p4://$sourcePort@$sourceChange</pre>
</div>
</div>
<div class="paragraph">
<p>might produce:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Original change description</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Transferred from p4://source-server:1667@2342</pre>
</div>
</div>
<div class="paragraph">
<p>Custom format:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Originally $sourceChange by $sourceUser on $sourcePort\n$sourceDescription</pre>
</div>
</div>
<div class="paragraph">
<p>might produce:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Originally 2342 by FBlogs on source-server:1667
Original change description</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_recording_a_change_list_mapping_file">4.8.2. Recording a change list mapping file</h4>
<div class="paragraph">
<p>There is an option in the configuration file to specify a change_map_file. If you set this option (default is blank), then P4Transfer will append rows to the specified CSV file showing the relationship between source and target changelists, and will automatically check that file in after every process.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>change_map_file = depot/import/change_map.csv</pre>
</div>
</div>
<div class="paragraph">
<p>The result change map file might look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ head change_map.csv
sourceP4Port,sourceChangeNo,targetChangeNo
src-server:1666,1231,12244
src-server:1666,1232,12245
src-server:1666,1233,12246
src_server:1666,1234,12247
src-server:1666,1235,12248</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is very straight forward to use standard tools such as grep to search this file. Because it is checked in to the target server, you can also use “p4 grep”.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You will need to ensure that the change_map filename is properly mapped in the local workspace - thus it must
include <code>&lt;depot&gt;</code> and other pathname components in the path. When you have created your target workspace, run <code>p4 client -o</code>
to check the view mapping.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_misc_usage_notes">5. Misc Usage Notes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Note that since labeling itself is not versioned no labels or tags are transferred.</p>
</div>
<div class="sect2">
<h3 id="_integration_recrods">5.1. Integration Recrods</h3>
<div class="paragraph">
<p>Branching and integrating with is implemented, as long as both source and target are within the workspace view. Otherwise, the integrate action is downgraded to an add or edit.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_as_a_service_on_windows">5.2. Setting up as a service on Windows</h3>
<div class="paragraph">
<p>P4Transfer can be setup as a service on Windows using <code>srvinst.exe</code> and <code>srvanay.exe</code> to wrap the Python interpreter, or <a href="https://nssm.cc/">NSSM - The Non-Sucking Service Manager</a></p>
</div>
<div class="paragraph">
<p>Please contact <code>consulting@perforce.com</code> for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_comparing_repositories_and_fixing_any_differences">5.3. Comparing Repositories (and fixing any differences)</h3>
<div class="paragraph">
<p>The helper script <code>CompareRepos.py</code> is useful to do occasional comparisons between source and target, and if required to "correct" or "fix" them.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>nohup CompareRepos.py -c config.yaml -s //depot/src/...@1234 &gt; compare.out &amp;</pre>
</div>
</div>
<div class="paragraph">
<p>If you want to open all files for the corrective action (e.g. add for missing, delete for extra, edit for modified), then add the <code>--fix</code> option:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>nohup CompareRepos.py -c config.yaml -s //depot/src/...@1234 --fix &gt; compare.out &amp;</pre>
</div>
</div>
<div class="paragraph">
<p>After that has completed, the files will be opened in the <code>target</code> client workspace from the config file, and you can manually submit them, e.g.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd target
p4 opened | less                &lt;==== review to see if as expected</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>nohup p4 submit -d "Fixup differences with //depot/src/...@1234"  &gt; sub.out &amp;</pre>
</div>
</div>
<div class="paragraph">
<p>Make sure the submit has succeeded!</p>
</div>
<div class="sect3">
<h4 id="_comparerepos_py">5.3.1. CompareRepos.py</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>usage: CompareRepos.py [-h] [-c CONFIG] [-s SOURCE] [-t TARGET] [-f]

NAME:
    CompareRepos.py

DESCRIPTION:
    This python script (3.6+ compatible) will compare changelists in 2 repos
    It is a companion script to P4Transfer.py and reads the same source/target config file.

    Usage:

        python3 CompareRepos.py -h

    The script requires a config file as for P4Transfer.py
    The config file provides the Perforce connection information for both servers,
    and source/target client workspace names.

    For full documentation/usage, see project doc:

        https://github.com/perforce/p4transfer/blob/main/doc/P4Transfer.adoc

optional arguments:
  -h, --help            show this help message and exit
  -c CONFIG, --config CONFIG
                        Config file as used by P4Transfer - to read
                        source/target info
  -s SOURCE, --source SOURCE
                        Perforce path for source repo, e.g.
                        //depot/src/...@52342
  -t TARGET, --target TARGET
                        Optional: Perforce path for target repo, e.g.
                        //depot/targ/...@123 [or without rev for #head]. If
                        not specified then assumes --source value with
                        revision specifier removed
  -f, --fix             Fix problems by opening files for required action on
                        target to make src/target the same

Copyright (C) 2021-22 Robert Cowham, Perforce Software Ltd</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_support">6. Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Any errors in the script are highly likely to be due to some unusual integration history, which may have been done with an older version of the Perforce server.</p>
</div>
<div class="paragraph">
<p>If you have an error when running the script, please use summarise_log.sh to create
a summary log file to send. E.g.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>summarise_log.sh log-P4Transfer-20141208094716.log &gt; sum.log</pre>
</div>
</div>
<div class="paragraph">
<p>If you get an error message in the log file such as:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>P4TLogicException: Replication failure: missing elements in target changelist: /work/p4transfer/main/applications/util/Utils.java</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="literalblock">
<div class="content">
<pre>P4TLogicException: Replication failure: src/target content differences found: rev = 1 action = branch type = text depotFile = //depot/main/applications/util/Utils.java</pre>
</div>
</div>
<div class="paragraph">
<p>Then please also send the following:</p>
</div>
<div class="paragraph">
<p>A Revision Graph screen shot from the source server showing the specified file around the changelist which is being replicated. If
an integration is involved then it is important to show the source of the integration.</p>
</div>
<div class="paragraph">
<p>Filelog output for the file in the source Perforce repository, and filelog output for the source of the integrate being performed.
e.g.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>p4 -ztag filelog /work/p4transfer/main/applications/util/Utils.java@12412
p4 -ztag filelog /work/p4transfer/dev/applications/util/Utils.java@12412</pre>
</div>
</div>
<div class="paragraph">
<p>where 12412 is the changelist number being replicated when the problem occurred.</p>
</div>
<div class="sect2">
<h3 id="_re_running_p4transfer_after_an_error">6.1. Re-running P4Transfer after an error</h3>
<div class="paragraph">
<p>When an error has been fixed, you can usually re-start P4Transfer from where it left off. If the error occurred when validating changelist
say 4253 on the target (which was say 12412 on the source) but found to be incorrect, the process is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>p4 -p target-p4:1666 -u transfer_user -c transfer_workspace obliterate //transfer_workspace/...@4253,4253</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>(re-run the above with the -y flag to actually perform the obliterate)</pre>
</div>
</div>
<div class="paragraph">
<p>Ensure that the counter specified in your config file is set to a value less than 4253 such as the changelist
immediately prior to that changelist.
Then re-run P4Transfer as previously.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributors_guide">7. Contributor&#8217;s Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pull Requests are welcome. Code changes should normally be accompanied by tests.</p>
</div>
<div class="paragraph">
<p>See <a href="../test/TestP4Transfer.py">TestP4Transfer.py</a> for unit/integration tests.</p>
</div>
<div class="paragraph">
<p>Most tests generate a new <code>p4d</code> repository with source/target servers and run test transfers.</p>
</div>
<div class="paragraph">
<p>The use the <a href="http://blog.pallen.co.uk/?p=15">"rsh" hack</a> to avoid having to spawn p4d on a port.</p>
</div>
<div class="sect2">
<h3 id="_test_dependencies">7.1. Test dependencies</h3>
<div class="paragraph">
<p>Tests assume there is a valid <code>p4d</code> in your current PATH.</p>
</div>
</div>
<div class="sect2">
<h3 id="_running_a_single_test">7.2. Running a single test</h3>
<div class="paragraph">
<p>Pick your single test class (e.g. <code>testAdd</code>):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>python3 TestP4Transfer.py TestP4Transfer.testAdd</pre>
</div>
</div>
<div class="paragraph">
<p>This will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>generate a single log file: <code>log-TestP4Transfer-*.log</code></p>
</li>
<li>
<p>create a test sub-directory <code>_testrun_transfer</code> with the following structure:</p>
<div class="literalblock">
<div class="content">
<pre>source/
    server/         # P4ROOT and other files for server - uses rsh hack for p4d
    client/         # Root of client used to checkin files
    .p4config       # Defines P4PORT for source server
target/             # Similar structure to source/
transfer_client/    # The root of shared transfer client</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This test directory is created new for each test, and then left behind in case of test failures.
If you want to manually do tests or view results, then <code>export P4CONFIG=.p4config</code>, and <code>cd</code> into
the source/target directory to be able to run normal <code>p4</code> commands as appropriate.</p>
</div>
</div>
<div class="sect2">
<h3 id="_running_all_tests">7.3. Running all tests</h3>
<div class="literalblock">
<div class="content">
<pre>python3 TestP4Transfer.py</pre>
</div>
</div>
<div class="paragraph">
<p>It will generate many log files (<code>log-TestP4Transfer-*.log</code>) which can be examined in case of failure or removed.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version v2022.1<br>
Last updated 2022-10-15 19:28:40 +0100
</div>
</div>
</body>
</html>